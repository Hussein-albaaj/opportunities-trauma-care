---
title: "Study plan"
output:
#  word_document: default
 # pdf_document: default
bibliography: citations.bib
csl: bmcemerg.csl
link-citations: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


```{r include=FALSE}
xy<-read.csv('swetrau-scrambled.csv')

xy$intub <- with(xy, ifelse(`pre_intubated` == 1 & is.na(xy$pre_intubated) == FALSE, 3, `ed_intubated`))

library(naniar)
ab<-xy %>% replace_with_na(replace = list( "res_survival" = 999))
ac<-ab %>% replace_with_na(replace = list( "intub" = 999))
swetrau<-ac %>% replace_with_na(replace = list( "host_care_level" = 999))

library(dplyr)

swetrau$ed_sbp_value[is.na(swetrau$ed_sbp_value)]<-350

swetrau$ed_sbp_value[swetrau$ed_sbp_value>=1 & swetrau$ed_sbp_value<=49]<-1
swetrau$ed_sbp_value[swetrau$ed_sbp_value>=50 & swetrau$ed_sbp_value<=75]<-2
swetrau$ed_sbp_value[swetrau$ed_sbp_value>=76 & swetrau$ed_sbp_value<=89]<-3
swetrau$ed_sbp_value[swetrau$ed_sbp_value>89 & swetrau$ed_sbp_value<=298]<-4
swetrau$ed_sbp_value[swetrau$ed_sbp_value==350]<-5
swetrau$ed_sbp_value[swetrau$ed_sbp_value==999]<-5

swetrau$sbp_rts<-with(swetrau, ifelse(ed_sbp_rtscat!=999 & is.na(swetrau$ed_sbp_rtscat)==FALSE,ed_sbp_rtscat,ed_sbp_value))

swetrau$ed_rr_value[is.na(swetrau$ed_rr_value)]<-350

swetrau$ed_rr_value[swetrau$ed_rr_value>=1 & swetrau$ed_rr_value<=5]<-1
swetrau$ed_rr_value[swetrau$ed_rr_value>=6 & swetrau$ed_rr_value<=9]<-2
swetrau$ed_rr_value[swetrau$ed_rr_value>=10 & swetrau$ed_rr_value<=29]<-4
swetrau$ed_rr_value[swetrau$ed_rr_value>29 & swetrau$ed_rr_value<=70]<-3
swetrau$ed_rr_value[swetrau$ed_rr_value==99]<-5
swetrau$ed_rr_value[swetrau$ed_rr_value==350]<-5
swetrau$ed_rr_value[swetrau$ed_rr_value==999]<-5

swetrau$ed_rr_rts<-with(swetrau, ifelse(is.na(swetrau$ed_rr_rtscat)==FALSE & ed_rr_rtscat != 999,ed_rr_rtscat,ed_rr_value))

swetrau$pre_rr_value[swetrau$pre_rr_value>=1 & swetrau$pre_rr_value<=5]<-1
swetrau$pre_rr_value[swetrau$pre_rr_value>=6 & swetrau$pre_rr_value<=9]<-2
swetrau$pre_rr_value[swetrau$pre_rr_value>=10 & swetrau$pre_rr_value<=29]<-4
swetrau$pre_rr_value[swetrau$pre_rr_value>29 & swetrau$pre_rr_value<=70]<-3
swetrau$pre_rr_value[swetrau$pre_rr_value==99]<-5
swetrau$pre_rr_value[swetrau$pre_rr_value==350]<-5
swetrau$pre_rr_value[swetrau$pre_rr_value==999]<-5

swetrau$pre_rr_rts<-with(swetrau, ifelse(is.na(swetrau$pre_rr_rtscat)==FALSE & pre_rr_rtscat != 999,pre_rr_rtscat,pre_rr_value))

swetrau$rr_rts<-with(swetrau, ifelse(intub == 3 & pre_rr_rts !=5 & pre_rr_rtscat != 999,pre_rr_rts,ed_rr_rts))

swetrau$rr_rts[swetrau$rr_rts==999]<-5

swetrau$ed_gcs_sum[is.na(swetrau$ed_gcs_sum)]<-350

swetrau$ed_gcs_sum[swetrau$ed_gcs_sum>=3 & swetrau$ed_gcs_sum<=8]<-1
swetrau$ed_gcs_sum[swetrau$ed_gcs_sum>=9 & swetrau$ed_gcs_sum<=12]<-2
swetrau$ed_gcs_sum[swetrau$ed_gcs_sum>=13 & swetrau$ed_gcs_sum<=15]<-3
swetrau$ed_gcs_sum[swetrau$ed_gcs_sum==99]<-5
swetrau$ed_gcs_sum[swetrau$ed_gcs_sum==350]<-5
swetrau$ed_gcs_sum[swetrau$ed_gcs_sum==999]<-5

swetrau$pre_gcs_sum[is.na(swetrau$pre_gcs_sum)]<-350

swetrau$pre_gcs_sum[swetrau$pre_gcs_sum>=3 & swetrau$pre_gcs_sum<=8]<-1
swetrau$pre_gcs_sum[swetrau$pre_gcs_sum>=9 & swetrau$pre_gcs_sum<=12]<-2
swetrau$pre_gcs_sum[swetrau$pre_gcs_sum>=13 & swetrau$pre_gcs_sum<=15]<-3
swetrau$pre_gcs_sum[swetrau$pre_gcs_sum==99]<-5
swetrau$pre_gcs_sum[swetrau$pre_gcs_sum==350]<-5
swetrau$pre_gcs_sum[swetrau$pre_gcs_sum==999]<-5

swetrau$gc<-with(swetrau, ifelse(intub == 3 & pre_gcs_sum !=5,pre_gcs_sum,ed_gcs_sum))
swetrau$gcs<-with(swetrau, ifelse(intub == 1 & gc ==5,99,gc))
swetrau$gcs_sum<-with(swetrau, ifelse(intub == 3 & gcs ==5,99,gcs))

library(dplyr)
rak.var<-c("Gender","intub","res_survival","host_care_level","rr_rts","sbp_rts","gcs_sum")
cont.var<-c("ISS","dt_ed_first_ct","dt_ed_emerg_proc","pt_age_yrs")

ba<-select(swetrau,rak.var,cont.var)

with(ba,sum(is.na(res_survival)))

ki<-swetrau[!is.na(swetrau$intub),]

library(readr)

problem_scrambled<-read.csv('problem-scrambled.csv')

rename(problem_scrambled,probYN=`Problemomrade_.FMP`)

nk<-merge(ki,problem_scrambled,by='id')

nk$probYN <- with(nk, ifelse(`Problemomrade_.FMP` == 'Ok'| `Problemomrade_.FMP` == 'FÃ¶redÃ¶mligt handlagd'|
 `Problemomrade_.FMP` == 'ok' & is.na(nk$Problemomrade_.FMP) == FALSE, 'Yes', 'No'))

cat.var<-c("id","probYN","Gender","res_survival","intub","host_care_level","rr_rts","sbp_rts","gcs_sum")
cont.var<-c("ISS","dt_ed_first_ct","dt_ed_emerg_proc","pt_age_yrs")

library(dplyr)

nks<-select(nk,cat.var,cont.var)

nkk<-subset(nks,!(pt_age_yrs%in%c(1,2,3,4,5,6,7,8,9,10,11,12,13,14)))

aa<-na.omit(nkk)
data.frame(table(aa$probYN))

ae<-aa

str(ae)
ae$probYN<-as.factor(ae$probYN)
ae$Gender<-as.factor(ae$Gender)
ae$host_care_level<-as.factor(ae$host_care_level)
ae$intub<-as.factor(ae$intub)
ae$res_survival<-as.factor(ae$res_survival)
ae$rr_rts<-as.factor(ae$rr_rts)
ae$sbp_rts<-as.factor(ae$sbp_rts)
ae$gcs_sum<-as.factor(ae$gcs_sum)

pairs(ae,col=ae$probYN)

sex<-glm(probYN~Gender,data = ae,family = 'binomial')
summary(sex)

surv<-glm(probYN~res_survival,data = ae,family = 'binomial')
summary(surv)

tub<-glm(probYN~intub,data = ae,family = 'binomial')
summary(tub)

care<-glm(probYN~host_care_level,data = ae,family = 'binomial')
summary(care)

resp<-glm(probYN~rr_rts,data = ae,family = 'binomial')
summary(resp)

sysbp<-glm(probYN~sbp_rts,data = ae,family = 'binomial')
summary(sysbp)

gcs_var<-glm(probYN~gcs_sum,data = ae,family = 'binomial')
summary(gcs_var)

injury<-glm(probYN~ISS,data = ae,family = 'binomial')
summary(injury)

first_ct<-glm(probYN~dt_ed_first_ct,data = ae,family = 'binomial')
summary(first_ct)

first_proc<-glm(probYN~dt_ed_emerg_proc,data = ae,family = 'binomial')
summary(first_proc)

age<-glm(probYN~pt_age_yrs,data = ae,family = 'binomial')
summary(age)

logistic<-glm(probYN~.,data = ae,family = 'binomial')
summary(logistic)
plot(logistic)

glm.fit=glm(probYN~.,data = ae,family = binomial)

library(table1)

aa$probYN <-
  factor(aa$probYN,
         levels=c("Yes","No"),
         labels=c("Opportunity for improvement",
                  "No opportunity for improvement"))

aa$Gender <-
  factor(aa$Gender, levels=c("M","K"),
         labels=c("Male",
                  "Female"))

aa$res_survival <-
  factor(aa$res_survival, levels=c("1","2"),
         labels=c("Dead",
                  "Alive"))

aa$intub <-
  factor(aa$intub, levels=c("3","1","2"),
         labels=c("Pre-hospital Intubation",
                  "ED Intubation","Not Intubated"))

aa$host_care_level <-
  factor(aa$host_care_level, levels=c("1","2","3","4","5"),
         labels=c("ED","Admissioned","Surgical Ward","Specialized ward","ICU"))

aa$sbp_rts <-
  factor(aa$sbp_rts, levels=c("4","3","2","1","0","5"),
         labels=c(">89","76-89","50-75","1-49","0","Missing"))

aa$gcs_sum <-
  factor(aa$gcs_sum, levels=c("3","2","1","5","99"),
         labels=c("Mild: 13-15","Moderate: 9-12","Severe: 3-8","Missing","Pre-intubated"))

aa$rr_rts <-
  factor(aa$rr_rts, levels=c("3","4","2","1","0","5"),
         labels=c(">29","10-29","6-9","1-5","0","Missing"))

label(aa$ISS)      <- "Injury Severity Score"
label(aa$Gender)       <- "Gender"
label(aa$intub)     <- "Intubation"
label(aa$pt_age_yrs)       <- "Age"
label(aa$res_survival)       <- "Survival after 30 days"
label(aa$host_care_level)       <- "Highest hospital care level"
label(aa$intub)       <- "Intubation"
label(aa$rr_rts)       <- "Respiratory rate"
label(aa$sbp_rts)       <- "Systolic Blood Pressure"
label(aa$gcs_sum)       <- "GCS"
label(aa$dt_ed_first_ct)       <- "Time to first CT"
label(aa$dt_ed_emerg_proc)       <- "Time to intervention"

units(aa$pt_age_yrs)       <- "Years"
units(aa$dt_ed_first_ct)   <- "minutes"
units(aa$dt_ed_emerg_proc)   <- "minutes"
units(aa$sbp_rts)       <- "RTS"
units(aa$rr_rts)       <- "RTS"

table1(~ Gender + pt_age_yrs + res_survival + host_care_level + intub + ISS + rr_rts + sbp_rts +
         gcs_sum + dt_ed_first_ct + dt_ed_emerg_proc| probYN, data=aa)


library(PRISMAstatement)

flow_exclusions(
  incl_counts = c(nrow(xy),nrow(ki), nrow(nks), nrow(nkk),nrow(aa)),
  total_label = "Patients in the trauma registry",
  incl_labels = c("Intubation-status known", "Outcome identified", "Matching set criteria","Included in the study"),
  excl_labels = c("Intubation-status unknown", "Outcome unidentified", "Not meeting age criteria", "Missing value")
)

```

# List of Abbreviations

GCS ----    Glasgow Coma Scale

ISS   ----    Injury severity score

KUH   ----  Karolinska University Hospital

SweTrau ----       Swedish National Trauma Registry

M&M   ----        Mortality and Morbidity

RTS ----        Revised Trauma Score

# Introduction

Defined as physical injury and the body´s consequential response, trauma, is one of the leading causes of mortality and morbidity (M&M) in all age groups and the leading cause of mortality in people below the age of 44 [@David2021;@champion1990]. Approximately 4.3 million people die each year due to trauma [@James2020]. Motor vehicle crashes alone account for more than one million deaths and roughly between 20 and 50 million injuries annually [@Committee2013]. With an average of more than 7 days in the hospital each stay [@champion1990], trauma is one of the most prevalent reasons for admission. In 2020 road traffic accidents were third in disease burden worldwide, measured by Disability-Adjusted Life Years (DALY),  a term used to describe the impact of health problems and to measure the significance of improvement in medical care [@Murray1996;@Haagsma2015].

In many cases the outcome is mostly dependent on the quality of care acquired [@Dogrul2020], as observed in the decline of deaths by organ dysfunction, reduced from 5% of all trauma deaths to approximately 0% after the adaptation of various treatment strategies and improvement in critical care, demonstrated by a study conducted in Karolinska University Hospital (KUH) [@Ghorbani2014]. In a teaching hospital in Tehran, reviews of all trauma cases in 1 year displayed inappropriate care in 45% of all deaths and implied that approximately 26% of all trauma deaths were preventable [@Zafarghandi2003].Other studies have estimated preventable and potentially preventable trauma death rates up to 60% [@Konadu2020]. Airway management, inadequate chest compression, inadequate blood or fluid supply are some factors that previously were found in need of improvement in trauma care [@Zafarghandi2003;@Maio1996]. Advances in trauma care are the leading cause of the decreased number of preventable deaths according to the American College of Surgeons Committee [@Committee2013].

It has for a long period of time been of great importance to investigate factors that can be improved in trauma care and different methods are used to do so. The gold standard is M&M conferences, during which specific cases are reviewed to further investigate the reason behind the mortality or morbidity [@WHO2009]. The results are used to improve the trauma care and to decrease the number of preventable errors. Although these conferences are a vital part for advancement in trauma care, it remains a process that requires a great amount of resources and is still complicated to this day.

Despite the evidence supporting the use of predefined models for case selection, there is limited data on specific factors associated with opportunities for improvement in trauma care [@Slater2020]. Therefore, methods such as audit filters are adopted in trauma quality improvement programs. Audit filters are predefined factors used in the selection of cases for review and represent an unfavorable alternation, proclaimed leading to a disadvantageous outcome [@WHO2009;@Evans2009].The audit filters in KUH are systolic blood pressure under 90, Glasgow Coma Scale (GCS) less than 9 and not intubated, injury severity score (ISS) more than 15 but not admitted to the intensive care unit, time to acute intervention more than 60 minutes, time to computed tomography more than 30 minutes, and death within 30 days after trauma. A systematic review of audit filters in 2009 found no studies meeting set criteria determining the effectiveness of set audit filters [@Evans2009].

Trauma quality improvement programs rely on set filters for the selection of cases for M&M conferences. Some studies have found no major opportunities for improvement in currently used audit filters and believe further advancements are essential [@Cryer1996;@Copes1995]. We hypothesize that certain factors are associated with opportunity for improvement in trauma care. The aim of this study is to asses how patient level factors are associated with opportunity for improvement in trauma care for later development of models trained to identify cases with capacity for improvement. This can be investigated by the examination of many factors registered in our database.

# Methods

### Study design

We conducted a retrospective cohort study using data from the KUH trauma registry and the trauma care quality database, both from SweTrau, the Swedish National Trauma Registry. Established in 2004, the trauma registry includes information of pre-hospital, hospital, and post-hospital care in accordance with the Utstein template. Factors such as demographics, vital signs, time to procedure and time to intervention are registered [@Dick1999]. The trauma care quality database consists of the cases selected for review and the presence of opportunity for improvement is noted. The registries where linked and possible factors associated with opportunities for improvement were extracted. All statistical analysis were first done on synthetic data to ensure objectivity. Bi- and multivariable logistic regression were used to determine association with the presence of opportunity for improvement. 

### Setting

In Sweden, pre-hospital care is managed by paramedics and specially trained physicians. The trauma patient is triaged by EMS personnel at the scene, according to acuity. Patients are prioritized according to vital signs and mechanism of injury. For instance open head injuries are priority one. All trauma patients in Stockholm with priority one are transported to KUH to receive care by dedicated trauma teams. These teams consist of a trauma surgeon, an anaesthetist, an orthopaedic surgeon, a radiologist and specialized nurses. KUH in Solna is a level one trauma center, with direct access to radiology, operation, intensive care and interventions [@Social2015;@NKS2020].

Cases are selected for M&M conferences by specialized nurses mainly based on previously mentioned audit filters and reviewed by experienced specialists from all of the fields involved in the trauma team. Preventable errors in the care of the patient are identified in each case and registered to the database as a categorical variable. The absence of such errors is also registered. A plan to solve the problems identified is also presented by the board.

### Participants

The trauma registry includes all patients admitted with trauma team activation, regardless of ISS, as well as patients admitted without trauma team activation but found to have an ISS of more than 9. The previously mentioned audit filters are used to select patients for inclusion in the trauma care quality database and M&M review. The inclusion criteria for this study are patients included in the database, the registry and aged at least 15 years. We conducted a complete case analysis, hence patients with missing data in any of the covariates or outcome with the exception of GCS, respiratory rate, and systolic blood pressure were excluded. Data was collected for patients registered between 2014 and 2021.

```{r}
library(PRISMAstatement)

flow_exclusions(
  incl_counts = c(nrow(xy),nrow(ki), nrow(nks), nrow(nkk),nrow(aa)),
  total_label = "Patients in the trauma registry",
  incl_labels = c("Intubation-status known", "Outcome identified", "Matching set criteria","Included in the study"),
  excl_labels = c("Intubation-status unknown", "Outcome unidentified", "Not meeting age criteria", "Missing value")
)
```


### Variables

**Study outcome**

The study outcome is significantly associated with the outcome variable using any or all predictive variables. The outcome variable is the presence of opportunities for improvement, as labeled by the M&M review board, and defined as a binary variable with the levels "Yes - At least one opportunity for improvement identified" and "No - No opportunities for improvement identified". Data on this outcome will be extracted from the trauma care quality database. 

**Predictors**

As our aim is to assess how patient level factors are associated with opportunity for improvement, the database used will therefore have some factors that can be further examined [@Swetrau2020]. The selection of variables to be further examined are made through discussion within the research team and partly based on locally used audit filters and factors frequently registered in the database. Selected factors to be further examined are divided into categorical and continuous variables. The categorical variables are sex, survival after 30 days, highest level of hospital care, GCS, respiratory rate, systolic blood pressure and intubation of the patient. The continuous variables are age, ISS, time from arrival at the hospital until first CT and time from arrival at the hospital until first intervention.

### Data sources and measurements

All of the data is extracted from the KUH trauma registry and the trauma care quality database. Age and gender are registered to the registry via the patient’s personal number. Vital signs are measured on arrival to the emergency department by staff and the other variables are registered from the patient´s charts.

### Bias

Since this is not a blinded study it is of utter importance to acknowledge the risk of bias. Synthetic data will however be used to develop the analysis model and after satisfactory results implement it on the data collected from the databases. This is done to lower the risk of bias.

### Study size

We will include all patients from the KUH trauma care quality registry and the corresponding information from the KUH trauma registry. Registration took place between 2014 and 2021 with approximately 21000

### Quantitative variables

Such variables include age, systolic blood pressure, respiratory rate, ISS, GCS and time to CT and intervention as previously described. Systolic blood pressure and respiratory rate are registered to the database as either a continuous or a categorical value according to the Revised Trauma Score (RTS), but never both. We therefore made the decision to convert the continuous values, if registered, into corresponding categorical value and treat them all as categorical [table.1]. We also decided that all vital signs had to be treated similar and therefore divided GCS into categories based on RTS.

### Statistical methods

We did a complete case analysis of all patients in the Karolinska trauma care quality registry. Variables were handled and converted in accordance with the SweTrau Manual. Potential variables were selected based on currently used audit filters, expert consensus and common demographics. Due to GCS and respiratory rate not being registered in patients intubated before arrival at the emergency department we determined that the most reasonable solution would be to use pre-hospital values registered by paramedics, to include these patients. Bivariate and multivariable logistic regression were used to determine significant association with the presence of opportunity for improvement. Results are presented in an confidence level of 95% and a p value of less than 0,05 was considered significant.

# Results

Out of `r nrow(xy)` included in both the registry and database `r nrow(xy)-nrow(aa)` were excluded due to missing data and age under 15, producing a study group of `r nrow(aa)`. The most prevalent reason for exclusion was missing data in the variable XY15 with XY16 patients out of the `r nrow(xy)` registered. In the trauma care quality database XY17 patients were included with an opportunity for improvement in XY18  (XY19 %). The majority of patients were XY20 (XY21). The mean age for patients included was XY24.


### Factors associated with preventable errors
All selected variables unadjusted are presented in [Table 2] with respective p-value. Adjusted variables are presented in [table 3] through the use of logistic regression. The lowest p-value is found in the variable XY22 (XY23). The survival rate after 30 days among included patientens is XY25 (XY26, XY27, XY28)

```{r}
table1(~ Gender + pt_age_yrs + res_survival + host_care_level + intub + ISS + rr_rts + sbp_rts +
         gcs_sum + dt_ed_first_ct + dt_ed_emerg_proc| probYN, data=aa)
```


# References

