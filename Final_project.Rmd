---
title: "Factors associated with opportunities for improvement in trauma care"
output: bookdown::pdf_document2
bibliography: citation.bib
always_allow_html: true
csl: bmcemerg.csl
link-citations: yes
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```
```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.pos = 'H')
```
```{r, include=FALSE}
options(tinytex.verbose = TRUE)
```
\newpage

```{r library, include=FALSE}
library(readr)
library(naniar)
library(plyr)
library(dplyr)
library("questionr")
library(table1)
library(ggplot2)
library(gridExtra)
library(gtsummary)
library(DiagrammeR)
library(PRISMAstatement)
library(knitr)
library(gt)
library(tidyverse)
library(glue)
library(tinytex)
library(rmarkdown)
library(RMariaDB)
library(DBI)
library(keyring)
library(dotenv)
library(gtsummary)
library(flextable)
library(kableExtra)
library(ggpubr)
library(lubridate)
library(parameters)
```


```{r include=FALSE}
conn <- DBI::dbConnect(drv = RMariaDB::MariaDB(),
                       user = 'husseina',
                       password = Sys.getenv("DB_PASSWORD"),
                       db = "opportunities_for_improvement")


dataset.names <- setNames(nm = c("swetrau", "fmp", "atgarder", "problem"))
datasets <- lapply(dataset.names, function(dataset.name) dbReadTable(conn = conn, name = dataset.name))

attach(datasets)

swetrau$arrival <- as.POSIXct(strptime(swetrau$DateTime_ArrivalAtHospital, format = "%Y-%m-%d %H:%M"))
fmp$arrival <- as.POSIXct(strptime(fmp$Ankomst_te, format = "%Y%m%d %H:%M"))
problem$arrival <- as.POSIXct(strptime(problem$Ankomst_te, format = "%Y%m%d %H:%M"))
swetrau$id <- paste(swetrau$arrival, swetrau$PersonIdentity, swetrau$TempIdentity)
fmp$id <- paste(fmp$arrival, fmp$Personnummer, fmp$Reservnummer)
problem$id <- paste(problem$arrival, problem$Personnummer, problem$Reservnummer)

# Combine datasets
combined.data <- merge(fmp, problem, by = "id", all.x = TRUE)
combined.data <- merge(combined.data, swetrau, by = "id", all.x = TRUE)

detach(datasets)
combined.datasets<-filter(combined.data, as.Date(strptime(combined.data$Ankomst_te.x, format = "%Y%m%d %H:%M")) >="2017-01-01")

create_ofi <- function(data) {
    ## Check arguments
    assertthat::assert_that(is.data.frame(data))
    assertthat::assert_that(all(c("VK_avslutad", "Problemomrade_.FMP", "Fr1.14") %in% names(data)))
    ## Create ofi variable
    data$Problemomrade_.FMP <- tolower(data$Problemomrade_.FMP)
    levels.Problemomrade_.FMP <- unique(data$Problemomrade_.FMP)
    original.levels.Problemomrade_.FMP <- c(NA, "ok", "triage på akutmottagningen",
                                            "resurs", "lång tid till op", "lång tid till dt",
                                            "vårdnivå", "traumakriterier/styrning",
                                            "missad skada", "kommunikation", "neurokirurg",
                                            "föredömligt handlagd", "logistik/teknik",
                                            "dokumentation", "dokumetation", "bristande rutin", 
                                            "handläggning", "kompetens brist", "tertiär survey")
    if (!all(levels.Problemomrade_.FMP %in% original.levels.Problemomrade_.FMP))
        stop ("Levels in Problemomrade._FMP have changed.")
    levels.Fr1.14 <- unique(data$`Fr1.14`)
    original.levels.Fr1.14 <- c(NA, "1", "3", "2", "999")
    if (!all(levels.Fr1.14 %in% original.levels.Fr1.14))
        stop ("Levels in Fr1.14 have changed.")
    prob.filters <- with(data, `Problemomrade_.FMP` != "ok" & `Problemomrade_.FMP` != "föredömligt handlagd")
    prob.mortality <- with(data, `Fr1.14` == "2" | `Fr1.14` == "3")
    prob <- prob.filters | prob.mortality
    data$VK_avslutad <- tolower(data$VK_avslutad)
    levels.VK_avslutad <- unique(data$VK_avslutad)
    original.levels.VK_avslutad <- c("ja", NA, "nej")
    if (!all(levels.VK_avslutad %in% original.levels.VK_avslutad))
        stop ("Levels in VK_avslutad have changed.")
    quality.process.done <- data$VK_avslutad == "ja"
    ofi <- ifelse(prob, "Yes",
           ifelse(quality.process.done & !prob, "No", NA))
    ofi[quality.process.done & is.na(prob)] <- "No"
    return (ofi)
}

combined.datasets$ofi <- create_ofi(combined.datasets)
combined.datasets$ofi <- with(combined.datasets, ifelse(is.na(ofi) | ofi == "No", "No", "Yes"))


# Gör en kolumn med intub: 1, intub ED, 2. Ej intub. 3. Intub prehosp.
combined.datasets$intub <- with(combined.datasets, ifelse(`pre_intubated` == 1 & is.na(combined.datasets$pre_intubated) == FALSE, 3, `ed_intubated`))
# Förklaring: tub<- om pre inte är Na och är 1(ja), sant: konvertera till 3, Falskt: använd ed_intubated (1 är ja och 2 är nej)

# Gör om 999 till Na
ab<-combined.datasets %>% replace_with_na(replace = list( "res_survival" = 999))
ac<-ab %>% replace_with_na(replace = list( "intub" = 999))
ada<-ac %>% replace_with_na(replace = list( "host_care_level" = 999))
adab<-ada %>% replace_with_na(replace = list( "ed_sbp_rtscat" = 999))
adac<-adab %>% replace_with_na(replace = list( "ed_rr_rtscat" = 999))
adad<-adac %>% replace_with_na(replace = list( "pre_rr_rtscat" = 999))
adae<-adad %>% replace_with_na(replace = list( "ed_sbp_value" = 999))
adah<-adae %>% replace_with_na(replace = list( "ed_rr_value" = 999))
adag<-adah %>% replace_with_na(replace = list( "pre_rr_value" = 999))
adaj<-adag %>% replace_with_na(replace = list( "ed_gcs_sum" = 999))
swetrau<-adaj %>% replace_with_na(replace = list( "pre_gcs_sum" = 999))

# Gör om blodtryck till RTS
swetrau$ed_sbp_value[is.na(swetrau$ed_sbp_value)]<-350

swetrau$ed_sbp_value[swetrau$ed_sbp_value>=1 & swetrau$ed_sbp_value<=49]<-1
swetrau$ed_sbp_value[swetrau$ed_sbp_value>=50 & swetrau$ed_sbp_value<=75]<-2
swetrau$ed_sbp_value[swetrau$ed_sbp_value>=76 & swetrau$ed_sbp_value<=89]<-3
swetrau$ed_sbp_value[swetrau$ed_sbp_value>89 & swetrau$ed_sbp_value<=298]<-4
swetrau$ed_sbp_value[swetrau$ed_sbp_value==350]<-5

# Tar RTS värdet från ed, om det inte finns så använder den vanliga blodtrycket, som är grupperat enligt RTS.
swetrau$sbp_rts<-with(swetrau, ifelse(is.na(swetrau$ed_sbp_rtscat)==FALSE,ed_sbp_rtscat,ed_sbp_value))

# Samma med ed_RR
swetrau$ed_rr_value[is.na(swetrau$ed_rr_value)]<-350

swetrau$ed_rr_value[swetrau$ed_rr_value>=1 & swetrau$ed_rr_value<=5]<-1
swetrau$ed_rr_value[swetrau$ed_rr_value>=6 & swetrau$ed_rr_value<=9]<-2
swetrau$ed_rr_value[swetrau$ed_rr_value>=10 & swetrau$ed_rr_value<=29]<-4
swetrau$ed_rr_value[swetrau$ed_rr_value>29 & swetrau$ed_rr_value<=70]<-3
swetrau$ed_rr_value[swetrau$ed_rr_value==99]<-5
swetrau$ed_rr_value[swetrau$ed_rr_value==350]<-5

swetrau$ed_rr_rts<-with(swetrau, ifelse(is.na(swetrau$ed_rr_rtscat)==FALSE,ed_rr_rtscat,ed_rr_value))

# Samma med pre_RR
swetrau$pre_rr_value[swetrau$pre_rr_value>=1 & swetrau$pre_rr_value<=5]<-1
swetrau$pre_rr_value[swetrau$pre_rr_value>=6 & swetrau$pre_rr_value<=9]<-2
swetrau$pre_rr_value[swetrau$pre_rr_value>=10 & swetrau$pre_rr_value<=29]<-4
swetrau$pre_rr_value[swetrau$pre_rr_value>29 & swetrau$pre_rr_value<=70]<-3
swetrau$pre_rr_value[swetrau$pre_rr_value==99]<-5
swetrau$pre_rr_value[swetrau$pre_rr_value==350]<-5

swetrau$pre_rr_rts<-with(swetrau, ifelse(is.na(swetrau$pre_rr_rtscat)==FALSE ,pre_rr_rtscat,pre_rr_value))

swetrau$rr_rts<-with(swetrau, ifelse(intub == 3 & pre_rr_rts !=5,pre_rr_rts,ed_rr_rts))

swetrau$ed_gcs_sum[is.na(swetrau$ed_gcs_sum)]<-350

# Konvertera GCS till mild 13-15 (3), moderate 9-12 (2), severe 3-8. (1). 5 = MISSING
swetrau$ed_gcs_sum[swetrau$ed_gcs_sum>=3 & swetrau$ed_gcs_sum<=8]<-1
swetrau$ed_gcs_sum[swetrau$ed_gcs_sum>=9 & swetrau$ed_gcs_sum<=12]<-2
swetrau$ed_gcs_sum[swetrau$ed_gcs_sum>=13 & swetrau$ed_gcs_sum<=15]<-3
swetrau$ed_gcs_sum[swetrau$ed_gcs_sum==99]<-5
swetrau$ed_gcs_sum[swetrau$ed_gcs_sum==350]<-5

# Gör samma med pre_GCS
swetrau$pre_gcs_sum[is.na(swetrau$pre_gcs_sum)]<-350

swetrau$pre_gcs_sum[swetrau$pre_gcs_sum>=3 & swetrau$pre_gcs_sum<=8]<-1
swetrau$pre_gcs_sum[swetrau$pre_gcs_sum>=9 & swetrau$pre_gcs_sum<=12]<-2
swetrau$pre_gcs_sum[swetrau$pre_gcs_sum>=13 & swetrau$pre_gcs_sum<=15]<-3
swetrau$pre_gcs_sum[swetrau$pre_gcs_sum==99]<-5
swetrau$pre_gcs_sum[swetrau$pre_gcs_sum==350]<-5

# Skapa gcs_sum som blir vår nya gcs, 5=missing
swetrau$gc<-with(swetrau, ifelse(intub == 3 & pre_gcs_sum !=5,pre_gcs_sum,ed_gcs_sum))
swetrau$gcs<-with(swetrau, ifelse(intub == 1 & gc ==5,99,gc))
swetrau$gcs_sum<-with(swetrau, ifelse(intub == 3 & gcs ==5,99,gcs))

# Egen datafram för räkna missing data
fake.var<-c("Gender","res_survival","intub","host_care_level","rr_rts","sbp_rts","gcs_sum")
rak.var<-c("id","ofi","Gender","res_survival","intub","host_care_level","rr_rts","sbp_rts","gcs_sum")
cont.var<-c("ISS","dt_ed_first_ct","pt_age_yrs")
cont.procedure.var<-c("ISS","dt_ed_first_ct","pt_age_yrs","dt_ed_emerg_proc")
cat.var<-c("ofi","Gender","res_survival","intub","host_care_level","rr_rts","sbp_rts","gcs_sum")

# Gör ny dataframe för att räkna missing data
ba<-select(swetrau,rak.var,cont.var)
kl<-select(swetrau,fake.var,cont.var)
na.kl<-na.omit(kl)

# Sätt ihop databaser
calc<-ba

# Gör om till Na
calh<-calc %>% replace_with_na(replace = list('pt_age_yrs'=11))
calj<-calh %>% replace_with_na(replace = list('pt_age_yrs'=13))
calk<-calj %>% replace_with_na(replace = list('pt_age_yrs'=14))

# Gör om missing i vitalparametrar för att beräkna missing
calb<-calk %>% replace_with_na(replace = list('rr_rts'=5))
cald<-calb %>% replace_with_na(replace = list('sbp_rts'=5))
cale<-cald %>% replace_with_na(replace = list('gcs_sum'=5))

sew<-as.data.frame(freq.na(cale))

# Välj variabler
nks<-select(calk,cat.var,cont.var)

# Ta bort alla missing data
ki<- na.omit(nks)

# Kopiera dataframe
ae<-ki
aa<-ki

# Gör om till faktorer
str(aa)
aa$ofi<-as.factor(aa$ofi)
aa$Gender<-as.factor(aa$Gender)
aa$host_care_level<-as.factor(aa$host_care_level)
aa$intub<-as.factor(aa$intub)
aa$res_survival<-as.factor(aa$res_survival)
aa$rr_rts<-as.factor(aa$rr_rts)
aa$sbp_rts<-as.factor(aa$sbp_rts)
aa$gcs_sum<-as.factor(aa$gcs_sum)
aa$ISS<-as.numeric(aa$ISS)
aa$dt_ed_first_ct<-as.numeric(aa$dt_ed_first_ct)
aa$pt_age_yrs<-as.numeric(aa$pt_age_yrs)

# Ritar ut alla värden på graf
pairs(aa,col=aa$ofi)

# Resultat för varje variabel, unadjusted

sex<-glm(ofi~Gender,data = aa,family = 'binomial')
summary(sex)

surv<-glm(ofi~res_survival,data = aa,family = 'binomial')
summary(surv)

tub<-glm(ofi~intub,data = aa,family = 'binomial')
summary(tub)

care<-glm(ofi~host_care_level,data = aa,family = 'binomial')
summary(care)

resp<-glm(ofi~rr_rts,data = aa,family = 'binomial')
summary(resp)

sysbp<-glm(ofi~sbp_rts,data = aa,family = 'binomial')
summary(sysbp)

gcs_var<-glm(ofi~gcs_sum,data = aa,family = 'binomial')
summary(gcs_var)

injury<-glm(ofi~ISS,data = aa,family = 'binomial')
summary(injury)

first_ct<-glm(ofi~dt_ed_first_ct,data = aa,family = 'binomial')
summary(first_ct)


age<-glm(ofi~pt_age_yrs,data = aa,family = 'binomial')
summary(age)


# Table 1
aa$ofi <-
  factor(aa$ofi,
         levels=c("No","Yes"),
         labels=c("No opportunity for improvement",
                  "Opportunity for improvement"))

aa$Gender <-
  factor(aa$Gender, levels=c("M","K"),
         labels=c("Male",
                  "Female"))

aa$res_survival <-
  factor(aa$res_survival, levels=c("2","1"),
         labels=c("Alive",
                  "Dead"))

aa$intub <-
  factor(aa$intub, levels=c("2","3","1"),
         labels=c("Not Intubated","Pre-hospital Intubation",
                  "ED Intubation"))

aa$host_care_level <-
  factor(aa$host_care_level, levels=c("1","2","3","4","5"),
         labels=c("ED","Admissioned","surgical ward","Specialized ward","ICU"))

aa$sbp_rts <-
  factor(aa$sbp_rts, levels=c("4","3","2","1","0","5"),
         labels=c(">89","76-89","50-75","1-49","0","Missing"))

aa$gcs_sum <-
  factor(aa$gcs_sum, levels=c("3","2","1","5","99"),
         labels=c("Mild: 13-15","Moderate: 9-12","Severe: 3-8","Missing","Pre-intubated"))

aa$rr_rts <-
  factor(aa$rr_rts, levels=c("4","3","2","1","0","5"),
         labels=c("10-29",">29","6-9","1-5","0","Missing"))

label(aa$ofi)      <- "Outcome"
label(aa$ISS)      <- "Injury Severity Score"
label(aa$Gender)       <- "Sex"
label(aa$intub)     <- "Intubation"
label(aa$pt_age_yrs)       <- "Age"
label(aa$res_survival)       <- "Survival after 30 days"
label(aa$host_care_level)       <- "Highest hospital care level"
label(aa$intub)       <- "Intubation"
label(aa$rr_rts)       <- "Respiratory rate"
label(aa$sbp_rts)       <- "Systolic Blood Pressure"
label(aa$gcs_sum)       <- "GCS"
label(aa$dt_ed_first_ct)       <- "Time to first CT"

units(aa$pt_age_yrs)       <- "Years"
units(aa$dt_ed_first_ct)   <- "minutes"
units(aa$sbp_rts)       <- "RTS"
units(aa$rr_rts)       <- "RTS"

# Resultat för adjusted variabels
outcome_log<-glm(ofi~.,data = aa,family = 'binomial')
summary(outcome_log)

opo<- as.data.frame(table1(~ Gender + pt_age_yrs + res_survival + host_care_level + intub + ISS + rr_rts + sbp_rts +
         gcs_sum + dt_ed_first_ct | ofi, data=aa))

# Kod för resultat-delen
# Värden för stapel-diagram
calculation<-aa
calculation$host_care_level <-
  factor(calculation$host_care_level, levels=c("ED","Admissioned","surgical ward","Specialized ward","ICU"),
         labels=c("ED","Adm","Surg","Spec","ICU"))

calculation$intub <-
  factor(calculation$intub, levels=c("Pre-hospital Intubation","ED Intubation","Not Intubated"),
         labels=c("Pre-Intub", "Intub","Not Intub"))

calculation$gcs_sum <-
  factor(calculation$gcs_sum, levels=c("Mild: 13-15","Moderate: 9-12","Severe: 3-8","Missing","Pre-intubated"),
         labels=c("13-15","9-12","3-8","Missing","Pre-intub"))

```

```{r include=FALSE, warning=FALSE}
app.ba<-select(swetrau,rak.var,cont.procedure.var)
app.kl<-select(swetrau,fake.var,cont.procedure.var)
app.calc<-app.ba

app.calh<-app.calc %>% replace_with_na(replace = list('pt_age_yrs'=11))
app.calj<-app.calh %>% replace_with_na(replace = list('pt_age_yrs'=13))
app.calk<-app.calj %>% replace_with_na(replace = list('pt_age_yrs'=14))

# Gör om missing i vitalparametrar för att beräkna missing
app.calb<-app.calk %>% replace_with_na(replace = list('rr_rts'=5))
app.cald<-app.calb %>% replace_with_na(replace = list('sbp_rts'=5))
app.cale<-app.cald %>% replace_with_na(replace = list('gcs_sum'=5))

app.sew<-as.data.frame(freq.na(app.cale))

app.nks<-select(app.calk,cat.var,cont.procedure.var)

app.ki<- na.omit(app.nks)
app.ae<-app.ki
app.aa<-app.ki

app.aa$ofi<-as.factor(app.aa$ofi)
app.aa$Gender<-as.factor(app.aa$Gender)
app.aa$host_care_level<-as.factor(app.aa$host_care_level)
app.aa$intub<-as.factor(app.aa$intub)
app.aa$res_survival<-as.factor(app.aa$res_survival)
app.aa$rr_rts<-as.factor(app.aa$rr_rts)
app.aa$sbp_rts<-as.factor(app.aa$sbp_rts)
app.aa$gcs_sum<-as.factor(app.aa$gcs_sum)
app.aa$ISS<-as.numeric(app.aa$ISS)
app.aa$dt_ed_first_ct<-as.numeric(app.aa$dt_ed_first_ct)
app.aa$dt_ed_emerg_proc<-as.numeric(app.aa$dt_ed_emerg_proc)
app.aa$pt_age_yrs<-as.numeric(app.aa$pt_age_yrs)
str(app.aa)

app.aa$ofi <-
  factor(app.aa$ofi,
         levels=c("No","Yes"),
         labels=c("No opportunity for improvement",
                  "Opportunity for improvement"))

app.aa$Gender <-
  factor(app.aa$Gender, levels=c("M","K"),
         labels=c("Male",
                  "Female"))

app.aa$res_survival <-
  factor(app.aa$res_survival, levels=c("1","2"),
         labels=c("Dead",
                  "Alive"))

app.aa$intub <-
  factor(app.aa$intub, levels=c("3","1","2"),
         labels=c("Pre-hospital Intubation",
                  "ED Intubation","Not Intubated"))

app.aa$host_care_level <-
  factor(app.aa$host_care_level, levels=c("1","2","3","4","5"),
         labels=c("ED","Admissioned","surgical ward","Specialized ward","ICU"))

app.aa$sbp_rts <-
  factor(app.aa$sbp_rts, levels=c("4","3","2","1","0","5"),
         labels=c(">89","76-89","50-75","1-49","0","Missing"))

app.aa$gcs_sum <-
  factor(app.aa$gcs_sum, levels=c("3","2","1","5","99"),
         labels=c("Mild: 13-15","Moderate: 9-12","Severe: 3-8","Missing","Pre-intubated"))

app.aa$rr_rts <-
  factor(app.aa$rr_rts, levels=c("3","4","2","1","0","5"),
         labels=c(">29","10-29","6-9","1-5","0","Missing"))

label(app.aa$ofi)      <- "Outcome"
label(app.aa$ISS)      <- "Injury Severity Score"
label(app.aa$Gender)       <- "Sex"
label(app.aa$intub)     <- "Intubation"
label(app.aa$pt_age_yrs)       <- "Age"
label(app.aa$res_survival)       <- "Survival after 30 days"
label(app.aa$host_care_level)       <- "Highest hospital care level"
label(app.aa$intub)       <- "Intubation"
label(app.aa$rr_rts)       <- "Respiratory rate"
label(app.aa$sbp_rts)       <- "Systolic Blood Pressure"
label(app.aa$gcs_sum)       <- "GCS"
label(app.aa$dt_ed_first_ct)       <- "Time to first CT"
label(app.aa$dt_ed_emerg_proc)       <- "Time to intervention"

units(app.aa$dt_ed_emerg_proc)   <- "minutes"
units(app.aa$pt_age_yrs)       <- "Years"
units(app.aa$dt_ed_first_ct)   <- "minutes"
units(app.aa$sbp_rts)       <- "RTS"
units(app.aa$rr_rts)       <- "RTS"

app.outcome_log<-glm(ofi~.,data = app.aa,family = 'binomial')
summary(app.outcome_log)

app.log<-tbl_regression(app.outcome_log,exponentiate = TRUE)

app.log
```

### Faktorer som associeras med möjligheter för utveckling inom trauma: En register-baserad retrospektiv cohort studie
Bakgrund: Trauma är en av de ledande orsakerna bakom mortalitet och morbiditet oberoende på ålder. Som observerats i många tidigare studier så är utfallet för patienterna väldigt beroende på kvaliteten av sjukvården. Mortalitet och mobiditet konferenser äger rum för att förbättra kvaliteten av vården inom trauma. I dessa så diskuteras specifika fall för att finna möjligheter för utveckling (MFU). Valet av fall som skall inkluderas inom deras konferenser är fortfarande komplicerat och ineffektivt. Metoder: En retrospektiv cohort studie som använde sig utav traumaregistret och trauma vårdkvalitetsregister som extraherades från SweTrau, det svenska nationella traumaregister. Tio faktorer inkluderades och kopplades med MFU som utfall. Bi- och multivariabel logistisk regression användes för att hitta en association mellan variablerna och utfallet. Resultat: Totalt 4643 fall som inkluderades. MFU hittades i 276 (5.94%) av alla fall. Medianåldern för patienter med MFU var 49, 42 in patienter utan MFU. Medianen av "injury severity score" (ISS) var 12 enheter högre bland patienter med MFU, 17 jämfört med 5 hos patienter utan MFU. Klinisk relevans identifierades hos bland annat variabeln "högsta vårdnivån". oddskvoten för MFU var 15.7 i specialiserade avdelningar jämfört med akuten. Slutsats: Högsta vårdnivå, ålder och ISS var markant associerade med MFU inom trauma. Framtida insatser bör fokusera på den orätvisan som finns bland vårdkvaliteten av olika patienter inom trauma. 

### Factors associated with opportunities for improvement in trauma care: A registry-based retrospective cohort study
Background: Trauma is one of the leading causes of mortality and morbidity in all age groups. As observed in many previous studies, the outcome in different cases is mostly dependent on the quality of care acquired. To improve the quality of care in trauma, mortality and morbidity conferences take place, during which specific cases are reviewed to further investigate opportunities for improvement (OFI). It is still however not clear how to select these cases in an efficient way. Methods: A retrospective cohort study using data from the trauma registry, and the trauma care quality database, both from the Swedish National Trauma Registry. Ten factors were included and linked with OFI as an outcome. Bi- and multivariable logistic regression were used to determine association with the presence of OFI. Results: A total of 4643 cases were applicable for the study. OFI was identified in 276 (5.94%) out of the cases. The median age for patients with OFI is 49, 42 in patients with no OFI. The median injury severity score (ISS) is also 12 units higher in the OFI-group, 17 compared to 5 with no OFI.  Distinctions were identified depending on the highest hospital care level. An odds ratio of 15.7 for OFI was found in the specialized ward compared to the ED. Conclusion: Higher hospital care level, age and ISS were found to be highly associated with OFI in trauma care. Future efforts should focus on the injustice in the quality of care for different patients in trauma. 

Keywords: Trauma, quality care, preventable errors, opportunity for improvement, audit filters

\newpage

# List of Abbreviations

DALY ---       Disability-Adjusted Life Years

ED ---       Emergency Department

GCS ---        Glasgow Coma Scale

ICU ---       Intensive Care Unit

ISS   ---        Injury severity score

KUH   ---        Karolinska University Hospital

M&M   ---        Mortality and Morbidity

OFI ---       Opportunity For Improvement

RR ---        Respiratory Rate

RTS ---        Revised Trauma Score

SBP ---       Systolic Blood pressure

SweTrau ---        Swedish National Trauma Registry


\newpage

# Introduction

Defined as physical injury and the body´s consequential response, trauma, is one of the leading causes of mortality and morbidity (M&M) in all age groups and the leading cause of mortality in people below the age of 44 [@David2021;@champion1990]. Approximately 4.5 million people die each year due to injury in the world [@James2020]. Motor vehicle crashes alone account for more than one million deaths and roughly between 20 and 50 million injuries annually [@Committee2013]. With an average of more than 7 days in the hospital each stay [@champion1990], trauma is one of the most prevalent reasons for admission. In 2020 road traffic accidents were third in disease burden worldwide, measured by Disability-Adjusted Life Years (DALY),  a term used to describe the impact of health problems and to measure the significance of improvement in medical care [@Murray1996;@Haagsma2015].

In many cases the outcome of the patient is mostly dependent on the quality of care acquired [@Dogrul2020], as observed in the decline of deaths by organ dysfunction, reduced from 5% of all trauma deaths to approximately 0% after the adaptation of various treatment strategies and improvement in critical care, demonstrated by a study conducted in Karolinska University Hospital (KUH) [@Ghorbani2014]. Advances in trauma care are the leading cause of the decreased number of preventable deaths according to the American College of Surgeons Committee [@Committee2013]. Inconsistencies in trauma care are prevalent in areas such as resources, diagnosis, and treatment. In a teaching hospital in Tehran, reviews of all trauma cases in 1 year displayed inappropriate care in 45% of all deaths and implied that approximately 26% of all trauma deaths were preventable [@Zafarghandi2003].Other studies have estimated preventable and potentially preventable trauma death rates up to 60% [@Konadu2020]. Airway management, inadequate chest compression, inadequate blood or fluid supply are some factors that previously were found in need of improvement in trauma care according to different studies [@Zafarghandi2003;@Maio1996].

It has for a long period of time been of great importance to investigate factors that can be improved in trauma care and different methods are used to do so. The gold standard is M&M conferences, during which specific cases are reviewed to further investigate the reason behind the mortality or morbidity [@WHO2009]. The results are used to improve the trauma care and to decrease the number of preventable errors. Although these conferences are a vital part for advancement in trauma care, it remains a process that requires a great amount of resources and is still complicated to this day.

Despite the evidence supporting the use of predefined models for case selection, there is limited data on specific factors associated with opportunities for improvement in trauma care [@Slater2020]. Therefore, methods such as audit filters are adopted in trauma quality improvement programs. Audit filters are predefined factors used in the selection of cases for review and represent an unfavorable alternation, proclaimed leading to a disadvantageous outcome [@WHO2009;@Evans2009]. Figure \@ref(fig:flowchart-process) demonstrates the selection of cases for M&M conferences using audit filters. The audit filters in KUH are systolic blood pressure under 90, Glasgow Coma Scale (GCS) less than 9 and not intubated, injury severity score (ISS) more than 15 but not admitted to the intensive care unit, time to acute intervention more than 60 minutes, time to computed tomography more than 30 minutes, and death within 30 days after trauma. A systematic review of audit filters in 2009 found no studies meeting set criteria determining the effectiveness of set audit filters [@Evans2009].

Trauma quality improvement programs rely on set filters for the selection of cases for M&M conferences. Some studies have found no major opportunities for improvement in currently used audit filters and believe further advancements are essential [@Cryer1996;@Copes1995]. We hypothesize that certain factors are associated with opportunity for improvement in trauma care. The aim of this study is to asses how patient level factors are associated with opportunity for improvement in trauma care for later development of models trained to identify cases with capacity for improvement. This can be investigated by the examination of many factors registered in our database.

```{r, include=FALSE}

DiagrammeR::grViz("
digraph graph2 {

graph [layout = dot, rankdir = RR]

# node definitions with substituted label text
node [shape = rectangle, width = 4, fillcolor = Biege]
a [label = '@@1']
b [label = '@@2']
c [label = '@@3']
d [label = '@@4']
e [label = '@@5']
f [label = '@@6']
h [label = '@@7']
g [label = '@@8']

a -> b -> c -> h -> d -> e -> f 
c->g

}

[1]: paste0('The occurence of a trauma')
[2]: paste0('Registration in SweTrau')
[3]: paste0('Primary review of audit filters by a nurse')
[4]: paste0('Secondary review by a colleague')
[5]: paste0('Multidisciplinary mortality and morbidity conference')
[6]: paste0('Consensus regarding existance of OFI')
[7]: paste0('Possible OFI identified')
[8]: paste0('No OFI identified')
") %>% DiagrammeRsvg::export_svg() %>% charToRaw() %>% rsvg::rsvg_pdf("flowchart_process.pdf")
```

```{r flowchart-process, fig.cap=" \\textbf{Flowchart describing the process of trauma cases from arrival until inclusion in Mortality and Morbidity conferences}", echo=FALSE, fig.align='center'}
knitr::include_graphics("flowchart_process.pdf")
```



# Methods

### Study design

A retrospective cohort study using data from the KUH trauma registry, and the trauma care quality database, both from SweTrau, the Swedish National Trauma Registry was conducted. Established in 2004, the trauma registry includes information of pre-hospital, hospital, and post-hospital care in accordance with the Utstein template [@Utstein2009]. Factors such as demographics, vital signs, time to procedure and time to intervention are registered [@Dick1999]. The trauma care quality database consists of the cases selected for review and the presence of opportunity for improvement is noted. The registries where linked and possible factors associated with opportunities for improvement were extracted. Bi- and multivariable logistic regression were used to determine association with the presence of opportunity for improvement.

### Setting

In Sweden, pre-hospital care is managed by paramedics and specially trained physicians. The trauma patient is triaged by EMS personnel at the scene, according to acuity. Patients are prioritized according to vital signs and mechanism of injury. For instance open head injuries are priority one. All trauma patients in Stockholm with priority one are transported to KUH to receive care by dedicated trauma teams. These teams consist of a trauma surgeon, an anaesthetist, an orthopaedic surgeon, a radiologist and specialized nurses. KUH in Solna is a level one trauma center, with direct access to radiology, operation, intensive care and interventions [@Social2015;@NKS2020].

Cases are selected for M&M conferences by specialized nurses mainly based on previously mentioned audit filters and reviewed by experienced specialists from all of the fields involved in the trauma team. Preventable errors in the care of the patient are identified in each case and registered to the database as a categorical variable. The absence of such errors is also registered. A plan to solve the problems identified is also presented by the board.

### Participants

The trauma registry includes all patients admitted with trauma team activation, regardless of ISS, as well as patients admitted without trauma team activation but found to have an ISS of more than 9. The previously mentioned audit filters are used to select patients for inclusion in the trauma care quality database and M&M review. The inclusion criteria for this study are patients included in the database, the registry and aged at least 15 years. A complete case analysis was conducted, hence patients with missing data in any of the covariates or outcome with the exception of GCS, respiratory rate, and systolic blood pressure were excluded. Data was collected for approximately 21 000 patients registered between 2017 and 2021.

```{r echo=F,results='asis',error=F,warning=F}
sewe<-filter(sew, missing != 0)

rownames(sewe)[rownames(sewe) == "res_survival"] = "Survival after 30 days"
rownames(sewe)[rownames(sewe) == "gcs_sum"] = "GCS"
rownames(sewe)[rownames(sewe) == "rr_rts"] = "Respiratory rate"
rownames(sewe)[rownames(sewe) == "intub"] = "Intubation"
rownames(sewe)[rownames(sewe) == "host_care_level"] = "Highest hospital care level"
rownames(sewe)[rownames(sewe) == "ofi"] = "Outcome"
rownames(sewe)[rownames(sewe) == "pt_age_yrs"] = "Age"
rownames(sewe)[rownames(sewe) == "dt_ed_first_ct"] = "Time to first CT"
rownames(sewe)[rownames(sewe) == "sbp_rts"] = "Systolic blood pressure"
rownames(sewe)[rownames(sewe) == "dt_ed_emerg_proc"] = "Time to intervention"
rownames(sewe)[rownames(sewe) == "Gender"] = "Sex"
```

### Variables

**Study outcome**

The study outcome is significantly associated with the outcome variable using any or all predictive variables. The outcome variable is the presence of opportunities for improvement, as labeled by the M&M review board, and defined as a binary variable with the levels "Yes - At least one opportunity for improvement identified" and "No - No opportunities for improvement identified". Presence of opportunities for improvement is defined as preventable error made in a specific patient case. Data on this outcome will be extracted from the trauma care quality database. 

**Predictors**

As our aim is to assess how patient level factors are associated with opportunity for improvement, the database used will therefore have some factors that can be further examined [@Swetrau2020]. The selection of variables to be further examined are made through discussion within the research team and partly based on locally used audit filters and factors frequently registered in the database. Selected factors to be further examined are divided into categorical and continuous variables. The categorical variables are sex, survival after 30 days, highest level of hospital care, GCS, respiratory rate, systolic blood pressure and intubation of the patient. The continuous variables are age, ISS, time from arrival at the hospital until first CT and time from arrival at the hospital until first intervention.

Systolic blood pressure and respiratory rate are registered to the database as either a continuous or a categorical value according to the Revised Trauma Score (RTS), but never both. The decision to convert the continuous values, if registered, into corresponding categorical value and treat them all as categorical was therefore made. All vital signs had to be treated similar and GCS will therefore be divided into categories based on RTS. 

### Data sources and measurements

All of the data is extracted from the KUH trauma registry and the trauma care quality database. Age and gender are registered to the registry via the patient’s personal number. Vital signs are measured on arrival to the emergency department by staff and the other variables are registered from the patient´s charts.

### Bias

Since this is not a blinded study it is of utter importance to acknowledge the risk of bias. Synthetic data will however be used to develop the analysis model and after satisfactory results implement it on the data collected from the databases. This is done to lower the risk of bias.

### Statistical methods

A complete case analysis of all patients in the Karolinska trauma care quality registry was done. Variables were handled and converted in accordance with the SweTrau Manual. Potential variables were selected based on currently used audit filters, expert consensus and common demographics. Due to GCS and respiratory rate not being registered in patients intubated before arrival at the emergency department the most reasonable solution would be to use pre-hospital values registered by paramedics, to include these patients. All statistical analysis were first done on synthetic data to ensure objectivity. Bi- and multivariable logistic regression were used to determine association with the presence of opportunity for improvement. Results are presented using a confidence level of 95% and a significance level of 95%.

# Results

The baseline characteristics of included patients are presented in Table \@ref(tab:sample-characteristics). Out of `r nrow(combined.datasets)` included in the trauma registry, between 2017 and 2021, `r nrow(combined.datasets)-nrow(na.kl)` were excluded due to missing data and age under 15, leaving a total of `r nrow(na.kl)` cases applicable for the study. The most prevalent reason for exclusion was missing data in the variable `r rownames(sewe[sewe$missing == sewe[1,1],])` with `r sewe[1,1]` patients, `r round(sewe[1,1]/nrow(combined.datasets)*100, digits = 2)`% of patients registered. The amount of cases excluded due to missing data in each variable is recorded in Table \@ref(tab:missing-data). In the trauma care quality database `r nrow(combined.datasets)-sum(is.na(combined.datasets$ofi))` of the cases were applicable for the study. After the combination of data from the trauma registry and the trauma care quality database and the removal of unqualified cases, a study group of `r nrow(aa)` is produced. Among the `r nrow(aa)` included patients, `r opo[3,4]` were male. The median age (Min, Max) for all patients was `r opo[7,4]`. The survival rate after 30 days among included patients was `r round(sum(aa$res_survival=='Alive')/nrow(aa)*100, digits = 2)`%.

```{r sample-characteristics, fig.align='center', echo = FALSE}
table1_t <- table1(~ pt_age_yrs + Gender + res_survival + host_care_level + intub + ISS + rr_rts + sbp_rts +
         gcs_sum + dt_ed_first_ct | ofi, data=aa, caption = "Sample characteristics")

table1.conv <- t1kable(table1_t) %>%
  kable_styling(latex_options = "HOLD_position", full_width = F, position = "center")

table1.conv
```

```{r missing-data, echo = FALSE, fig.align='center'}
missing_table <- knitr::kable(sewe[,1:2], format = "markdown", caption = "<strong> Missing  values in each variable</strong>")

missing_table
```

### Factors associated with preventable errors
An opportunity for improvement was identified in `r sum(aa$ofi == "Opportunity for improvement")` (`r round(sum(aa$ofi == "Opportunity for improvement")/nrow(aa)*100, digits = 2)`%) out of the cases. The unadjusted and adjusted associations of selected variables with opportunities for improvement are presented through the use of logistic regression in Table \@ref(tab:var-adjusted) with respective p-value. Statistical significance before and after adjustment for other variables was found in the variables age, ISS, GCS and highest hospital care level. In the variables respiratory rate, systolic blood pressure and intubation a significant p-value was found only before adjustment for other variables. In survival after 30 days only after adjustment for other variables.

As seen in Table \@ref(tab:sample-characteristics) the median age for patients with OFI is 49, which is 7 years higher than the median for the group of patients with no OFI. The median ISS is also 12 units higher in the OFI-group, 17 compared to 5 in no OFI. In the variable GCS, statistical significance was found in patients with missing value after adjustment. As mentioned earlier these were included in the study. Both ISS and highest hospital care level displayed p-values lower than 0.001 both adjusted and unadjusted, intubation and age only unadjusted.


```{r j, include=FALSE}
tbl_merge_test <-
    tbl_merge(tbls = list(aa %>%
                              select(ofi, pt_age_yrs, Gender, res_survival, rr_rts, sbp_rts, gcs_sum, intub, host_care_level, ISS, dt_ed_first_ct) %>%
                              tbl_uvregression(
                                  method = glm,
                                  y = ofi,
                                  method.args = list(family = binomial),
                                  exponentiate = TRUE,
                                  pvalue_fun = ~style_pvalue(.x, digits = 2),
                                  hide_n = TRUE
                              )%>% bold_p(), tbl_regression(outcome_log,exponentiate = TRUE,pvalue_fun = ~style_pvalue(.x, digits = 2)) %>% bold_p() %>% bold_labels()))


hellp<- tbl_merge_test %>% modify_spanning_header(list (estimate_1 ~ "Unadjusted", ci_1 ~ "Unadjusted", p.value_1 ~ "Unadjusted", estimate_2 ~ "Adjusted", ci_2 ~ "Adjusted", p.value_2 ~ "Adjusted"))

flpp <- hellp %>% as_flex_table()
flpp <- set_table_properties(flpp, width = .8, layout = "autofit")

flpp <- theme_vanilla(flpp)
flpp <- set_caption(flpp, caption = "Adjusted and unadjusted variables")
flpp <- add_footer_lines(flpp, "Unadjusted and adjusted variables with odds ratio, confidence interval and p-values")
```

```{r var-adjusted, echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}
flpp
```


As seen in Figure \@ref(fig:care-level) there are clear distinctions between the different groups in highest hospital care level. An odds ratio of 15.7 is found in the specialized ward compared to the ED. 10.6 and 12.1 in the surgical wards and ICU respectively (Table \@ref(tab:var-adjusted)). In patients treated in a specialized ward an opportunity for improvement was identified in 15.2% of the cases, compared to 1.1% in patients treated in the ED. Results are incomplete in the variables systolic blood pressure and respiratory rate due to lack of patients in a few groups. 

```{r care-level, fig.cap=" \\textbf{Opportunity for improvement presented in the variable Highest hospital care level. ED = Emergency department, Adm = administered to a normal ward, Surg = surgical ward, Spec = Specialized ward}", echo=FALSE}

# Rita ut Stapeldiagram
calculation['Percentage']='100'

ggplot(calculation, aes(fill=ofi, y=Percentage, x=host_care_level)) + geom_bar(position = "fill", stat="identity") + guides(fill=guide_legend(title="OFI")) + labs(y = "Percent (%)", x = "Survival (30 days)") + rremove("grid")
```

```{r bara testar, include=FALSE}
test.calc<- calculation
ggplot(data = test.calc, aes(x = factor(res_survival), 
                          y = prop.table(stat(count)), 
                          fill = factor(ofi), 
                          label = scales::percent(prop.table(stat(count))))) +
    geom_bar(position = "dodge") + 
    geom_text(stat = 'count',
              position = position_dodge(0.9), 
              vjust = -0.5,
              size = 3) + 
    scale_y_continuous(labels = scales::percent) + 
    labs(x = 'cyl', y = 'pct', fill = 'gear')
```



```{r hkl, include=FALSE}

opportunity_sex <-ggplot(calculation, aes(fill=ofi, y=Percentage, x=Gender)) + geom_bar(position = "fill", stat="identity")+ rremove("ylab") + theme(legend.position="none") + rremove("grid") + labs(y = "Percent (%)", x = "Sex") + guides(fill=guide_legend(title="OFI"))




opportunity_survival <-ggplot(calculation, aes(fill=ofi, y=Percentage, x=res_survival)) + 
    geom_bar(position = "fill", stat="identity") + rremove("ylab") + theme(legend.position="none") + rremove("grid") + labs(y = "Percent (%)", x = "Survival after 30 days") + guides(fill=guide_legend(title="OFI"))




opportunity_intub <-ggplot(calculation, aes(fill=ofi, y=Percentage, x=intub)) + geom_bar(position = "fill", stat="identity")+ rremove("ylab") + theme(legend.position="none") + rremove("grid") + labs(y = "Percent (%)", x = "Intubation") + guides(fill=guide_legend(title="OFI"))




opportunity_rr <-ggplot(calculation, aes(fill=ofi, y=Percentage, x=rr_rts)) + geom_bar(position = "fill", stat="identity")+ rremove("ylab") + theme(legend.position="none") + rremove("grid") + labs(y = "Percent (%)", x = "Respiratory rate") + guides(fill=guide_legend(title="OFI"))




opportunity_sbp <-ggplot(calculation, aes(fill=ofi, y=Percentage, x=sbp_rts)) + geom_bar(position = "fill", stat="identity")+ rremove("ylab") + theme(legend.position="none") + rremove("grid") + labs(y = "Percent (%)", x = "Systolic blood pressure") + guides(fill=guide_legend(title="OFI"))




opportunity_gcs <-ggplot(calculation, aes(fill=ofi, y=Percentage, x=gcs_sum)) + geom_bar(position = "fill", stat="identity")+ rremove("ylab") + theme(legend.position="none") + rremove("grid") + labs(y = "Percent (%)", x = "Glasgow coma scale") + guides(fill=guide_legend(title="OFI"))


pp<- ggarrange(opportunity_sex, opportunity_survival ,opportunity_intub, opportunity_rr, opportunity_sbp, opportunity_gcs,
          labels = c("A", "B", "C", "D","E","F"),
          ncol = 3, nrow = 2, common.legend = TRUE, legend = "bottom")

hpp <- pp + labs(caption = "Opportunity for improvement presented in the remaining  variables. Intub = Intubated, Pre-intub = Patient intubated before arrival at the emergency department.")
```

Figure \@ref(fig:rest-barchart) displays the proportion of OFI in the remaining variables. No clear distinction was found regarding OFI dependent on sex. In the variable systolic blood pressure OFI was found in 5.8% of the patients with a systolic blood pressure higher than 89, and 17.6% in patients with a systolic blood pressure between 50-75. No patients with a systolic blood pressure lower than 50 had an OFI. Patients intubated in the hospital also had a higher percentage of OFI compared to patients not intubated or intubated before arrival at the hospital. 

```{r rest-barchart, fig.cap= "\\textbf{Opportunity for improvement presented in the remaining  variables. Intub = Intubated, Pre-intub = Patient intubated before arrival at the emergency department}", echo=FALSE}

plot(hpp)

```
\newpage

# Discussion

This registry-based cohort study aimed to find factors associated with OFI in trauma care for improvement of the selection of cases for mortality and morbidity reviews. This study shows that there are some correlations between different factors and the occurrence of OFI in trauma care. Statistical significance was found in eight of the ten included variables, before or after the adjustment for other variables, or even both. The factor mostly associated with OFI is the highest hospital care level, with an odds ratio of 15.7 and 12.1 in specialized wards and ICU respectively, compared to the ED. Meaning that patients treated in the specialized wards and ICU are much more likely to be exposed to preventable errors. A previous study in the US has shown that more than half of the preventable and probably preventable deaths occur in the ICU [@Teixeira2007]. This could be explained by the usual complexity of cases treated in the ICU. The most prevalent reasons found to be the cause of preventable errors are airway management and perioperative care according to this study in California, those patients are usually found in the ICU [@Teixeira2009]. Patients with ED as the highest hospital care level are usually less injured and therefore need less intervention which in turn leads to lower odds of preventable errors.

It is important to acknowledge that OFI and preventable errors are not equal to preventable deaths. This study also proves that there is no correlation between death within 30 days after trauma and preventable errors. Before the adjustment for other factors the p-value for survival after 30 days was not significant. There is however a significant p-value after the adjustment although it suggests that the odds of an OFI is higher in patients that are alive after 30 days. Although OFI in patients that die within 30 days after trauma is not equivalent to preventable deaths, due to the facts that an OFI does only imply that there is a preventable error but not the magnitude of that error, we estimated OFI to be found in 6.8% of all trauma deaths at KUH. A study performed by colleagues at KUH identified at least one preventable error in 21% of all trauma deaths, although only 4% of all trauma deaths were found to be preventable [@Ghorbani2018].

As seen in the results, the variable “Time to intervention” had to be excluded. It was noticed during the analysis of the results that nearly 81% of the cases had missing values in that variable. If all of these cases were to be excluded there would be a shift in the results as there are many categories in some variables that would be without any cases (Table \@ref(tab:sample-character)). Table \@ref(tab:var-time) demonstrates the results if “Time to intervention” was to be included, p-value lower than 0.05 is not found in any variable. Only 977 patients would be included in that study with OFI in 141 of the cases, compared to 4643 patients without the variable with OFI in 276 of the cases. The removal of one variable is not optimal but we have to take into account that most of the patients in the ED would be excluded due to low percentage of intervention and that variable would be missing. That would in turn lead to misleading results. The decision was made to remove that variable and include the results with time to intervention in the appendix.

Other factors associated with opportunities for improvement are the continuous factors age and ISS. As seen in Table \@ref(tab:sample-characteristics) the median age differs between the two different groups, it is higher by 7 years in the OFI group. The reason behind the higher percentage of OFI in elder patients is still unclear. A systematic review published 2017 identified many studies where lower healthcare quality for elders was potentially justified by the lower chance of survival [@Salway2017]. The argument that focusing more resources on younger patients could lead to a lower mean value of DALY could be made. However, if such a decision of resource distribution is morally justified is not evident.

The median ISS was 17 in the OFI-group compared to 5 in cases with no OFI. The same arguments could be made here that patients with more complex injuries are more likely to be exposed to preventable errors. Two studies performed in Germany showed higher numbers of preventable errors in patients with ISS > 15 compared to the whole population. In Cologne when analyzing preventable and potentially preventable deaths in patients with ISS > 15 they estimated it to be 20.2% of all trauma deaths [@Schoeneberg2016]. When calculating the same numbers for all ages in Berlin it was estimated to be 15.1% of all trauma deaths [@Kleber2013].

When analyzing the vital signs included, some association with OFI was found. In respiratory rate >29 an OFI was found in 11.0% of the cases, compared to 5.8% in 10-29. A study performed in Iran showed similar findings when comparing preventable deaths between patients with RR <20 and 20 or higher. It was found that deaths in patients with 20 or higher in RR were more likely to be preventable [@Davoodabadi2021]. A theory explaining this could be the low frequency of cases with a RR over 29, meaning lower experience in the trauma team in those cases. There are also clear protocols on how to act in cases with hypoventilation, known by the majority of the trauma team. There is a possibility that protocols on hyperventilation are not as well known. These cases are usually more complex as well. 

A systolic blood pressure between 50 and 75 contributed to 3.5 more possibilities for an OFI compared to SBP over 89. Two different studies have both shown an odds ratio of 2.3 in SBP under 60 and 90 respectively [@Yadollahi2020;@GonzlezRobledo2015]. An OFI was identified in 17.6% of the cases with SBP 50-75 compared to 5.8% in cases with SBP over 89. Same argument as in highest hospital care could be made here that trauma patients with hypotension are more complex than those with normal SBP. A hypotension could be a consequence of hemorrhage and could in turn lead to a shock.

Statistical significance was also identified in patients intubated at the hospital, but not in those intubated before arrival. Intubation at the hospital contributed to 2.8 more possibilities for an OFI compared to non-intubated patients. As mentioned earlier, GCS less than 9 and not intubated was an audit filter at this hospital. In this study GCS was unfortunately not combined with intubation, however the reason behind higher percentage of OFI in patients intubated after the arrival at the hospital could be explained by the delay of intubation in these cases.No correlation to OFI was found in the variables sex and time to first CT.

# Strengths and limitations
One of the primary strengths of this study is that all trauma 1 patients in Stockholm during 4 years are included. Meaning that even patients not included in M&M conferences by audit filters are reviewed by nurses and sent to M&M conferences if any possibility of an OFI is present. Even cases not reviewed by the board during an M&M conference are included, these cases however lack OFI. This is important since the effectiveness of audit filters is not yet proven by any study and it also lowers the odds of any bias present as a consequence of audit filters and the selection of cases for M&M conferences. Other efforts to lower the odds of bias were to develop a model on synthetic data to later implement it on real data. 

The primary limitations were the removal of one variable, time to intervention, due to the fact that it had missing values in approximately 81% of the cases and the results would have been misleading since there is a correlation between less complex cases and no intervention. Even though the removal of a variable after gathering the results is not optimal, we realized that it had to be done to attain practical information. It was also discovered that the data was from 2017 and onward and not 2014 as promised earlier. Some cases were from before 2017 but these had to be excluded since they all had no OFI and the cases with OFI had to been registered improperly somehow. 

Finally, the results of both unadjusted and adjusted factors have to be mentioned as a strength. As discussed earlier there are some differences in the significance of a factor depending on if it is analyzed by itself or compared to other variables. When removing the factor time to intervention it was noticed that some factors are strongly correlated to other factors, such as time to intervention and highest hospital care level, where patients with missing in time to intervention were usually in lower hospital care levels. Another example is GCS and intubation, were patients with lower GCS were usually intubated. When analyzing the variables after the adjustment for other variables, we can see the true effect of that variable on the outcome.

# Clinical applications

The aim of this study was to find factors associated with opportunities for improvement to make further advancements in trauma care. New information was gathered using data never used before. Many factors were found to be associated with OFI. This information could be used to train personnel and develop new strategies to lower the frequency of preventable errors. The selection of cases for M&M conferences in trauma could also be made easier using the results from this study. There is also hope that this study sheds more light on existing problems in trauma care and the injustice in the quality of care dependent on factors such as age.

Equity
Sex was a factor in the study. As mentioned in the results there were no correlation between OFI and the two different sex. Trauma is however more prevalent in males (68%). More studies are needed to find differences in trauma care dependent on sex, if such differences are present. Children under the age 15 were not included in the study, meaning no comparison between children and adults was made. However the median age was higher in cases with OFI meaning that there is a difference in the quality of care dependent on age. 

# Future studies
Future studies are needed globally to achieve the attention that is required to decrease the number of preventable errors in trauma care. It is also needed since the quality of care can differ between hospitals. This is not only a problem in trauma care but in all specialities. The database used also had approximately 200 factors registered, these could also be examined in future studies. As discussed earlier this study did not examine the effectiveness of all audit filters but only variables. Audit filters such as GCS under 9 and not intubated could be examined by the association of two different factors. 

# Conclusion
In conclusion higher hospital care level, age and injury severity score were found to be highly associated with OFI in trauma care. Other factors had some correlation to OFI. Some adjustments could be made to make the selection of cases for mortality and morbidity conferences more efficient to save resources. Future efforts should focus on the injustice in the quality of care for different patients in trauma. Development of models trained to identify cases with capacity for improvement is a possibility.

# Contribution
Medical student Elias Jorneborg used the same databases and had the same supervisors. His study however focused on the incidence of OFI in different cohorts. This study focused on OFI dependent on different factors to analyze the effectiveness of audit filters and in the future implement effective audit filters.

# Acknowledgment
I would like to thank my supervisors Martin Gerdin Wärnberg and Jonatan Attergrim for making this project possible and for guiding me through it. It would have not been possible to finish this project without their guidance and support. I would also like to thank the administrative personnel responsible for the database and for giving us access. 

# Appendix
Flowchart of excluded patients (Figure \@ref(fig:missing-fig))

```{r include=FALSE}

missing_fig <- flow_exclusions(
  incl_counts = c(nrow(combined.datasets),nrow(calk), nrow(ki)),
  total_label = "Patients in the trauma registry",
  incl_labels = c("Outcome identified", "Included in the study"),
  excl_labels = c("Outcome unidentified", "Missing data")
)

missing_fig%>% DiagrammeRsvg::export_svg() %>% charToRaw() %>% rsvg::rsvg_pdf("flowchart_ex.pdf")
```

```{r missing-fig, fig.cap=" \\textbf{Flowchart of excluded patients}", echo=FALSE, fig.align='center'}
knitr::include_graphics("flowchart_ex.pdf")
```


Table of sample characteristics, if Time to procedure was included (Table \@ref(tab:sample-character))

```{r sample-character, fig.align='center', echo = FALSE}
table2_t <- table1(~ Gender + pt_age_yrs + res_survival + host_care_level + intub + ISS + rr_rts + sbp_rts + gcs_sum + dt_ed_first_ct + dt_ed_emerg_proc | ofi, data=app.aa, caption = "Sample characteristics, if Time to procedure was included")

t1kable(table2_t) %>%
  kable_styling(latex_options = "HOLD_position", full_width = F, position = "center")
```

Table with unadjusted and adjusted variables with odds ratio, confidence interval and p-value respectively (Table \@ref(tab:var-time))

```{r, include=FALSE}

tbl_merge_test3 <-
    tbl_merge(tbls = list(app.aa %>%
                              select(ofi, Gender, pt_age_yrs, res_survival, rr_rts, sbp_rts, gcs_sum, intub, host_care_level, ISS, dt_ed_first_ct, dt_ed_emerg_proc) %>%
                              tbl_uvregression(
                                  method = glm,
                                  y = ofi,
                                  method.args = list(family = binomial),
                                  exponentiate = TRUE,
                                  pvalue_fun = ~style_pvalue(.x, digits = 2),
                                  hide_n = TRUE
                              )%>% bold_p(), tbl_regression(app.outcome_log,exponentiate = TRUE,pvalue_fun = ~style_pvalue(.x, digits = 2)) %>% bold_p() %>% bold_labels()))


app.hellp<- tbl_merge_test3 %>% modify_spanning_header(list (estimate_1 ~ "Unadjusted", ci_1 ~ "Unadjusted", p.value_1 ~ "Unadjusted", estimate_2 ~ "Adjusted", ci_2 ~ "Adjusted", p.value_2 ~ "Adjusted"))



app.flpp <- app.hellp %>% as_flex_table()
app.flpp <- set_table_properties(app.flpp, width = .8, layout = "autofit")

app.flpp <- theme_vanilla(app.flpp)
app.flpp <- set_caption(app.flpp, caption = "Adjusted and unadjusted variables")
app.flpp <- add_footer_lines(app.flpp, "Unadjusted and adjusted variables with odds ratio, confidence interval and p-values")

app.flpp
```

```{r var-time, echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}
app.flpp
```
k.sex <- aa %>% count(ofi, Gender)
k.res <- aa %>% count(ofi, res_survival)
k.intub <- aa %>% count(ofi, intub)
k.host <- aa %>% count(ofi, host_care_level)
k.rr <- aa %>% count(ofi, rr_rts)
k.sbp <- aa %>% count(ofi, sbp_rts)
k.gcs <- aa %>% count(ofi, gcs_sum)
k.ISS <- aa %>% count(ofi, ISS)
k.age <- aa %>% count(ofi, pt_age_yrs)
k.ct <- aa %>% count(ofi, dt_ed_first_ct)


heeel = ddply(heeel, .(Gender), transform, percent = n/sum(n) * 100)
heeel = ddply(heeel, .(Gender), transform, pos = (cumsum(n) - 0.5 * n))
heeel$label = paste0(sprintf("%.0f", heeel$percent), "%")

ggplot(heeel, aes(x = factor(Gender), y = n, fill = ofi)) +
    geom_bar(position = position_stack(), stat = "identity", width = .7) +
    geom_text(aes(label = label), position = position_stack(vjust = 0.5), size = 4)


ggplot(heeel, aes(fill=ofi, y=Percentage, x=factor(Gender))) + geom_bar(position = "fill", stat="identity") + geom_text(aes(label = label), position = position_stack(vjust = 0.5), size = 4)


# References

